<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>투명한 조 편성기 (Glass Group Maker)</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #4c51bf 0%, #6b46c1 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .shape {
            position: absolute;
            filter: blur(50px);
            opacity: 0.7;
            animation: move 10s infinite alternate;
        }
        
        .shape-1 {
            top: -10%;
            left: -10%;
            width: 500px;
            height: 500px;
            background: #ff9a9e;
            border-radius: 50%;
        }
        .shape-2 {
            bottom: -10%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: #a18cd1;
            border-radius: 50%;
            animation-delay: -5s;
        }
        .shape-3 {
            top: 40%;
            left: 40%;
            width: 300px;
            height: 300px;
            background: #fbc2eb;
            border-radius: 50%;
            animation-duration: 15s;
        }

        @keyframes move {
            from { transform: translate(0, 0) rotate(0deg); }
            to { transform: translate(50px, 50px) rotate(20deg); }
        }

        textarea::-webkit-scrollbar, .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track, .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-thumb, .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="background-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const RefreshIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>;
        const UsersIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const CopyIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const CheckIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const TrashIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>;

        const App = () => {
            const [names, setNames] = useState('');
            const [groupSize, setGroupSize] = useState('4'); // 문자열로 관리하여 빈 값 허용
            const [groups, setGroups] = useState([]);
            const [isShuffling, setIsShuffling] = useState(false);
            const [copied, setCopied] = useState(false);

            const shuffleArray = (array) => {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            };

            const handleMakeGroups = () => {
                if (!names.trim()) {
                    alert("참여할 사람들의 이름을 입력해주세요!");
                    return;
                }

                // 실행 시점에 숫자로 변환 (없으면 1로 처리)
                const size = parseInt(groupSize) > 0 ? parseInt(groupSize) : 1;

                setIsShuffling(true);
                setGroups([]); 

                setTimeout(() => {
                    const nameList = names.split(/[\n,]+/).map(n => n.trim()).filter(n => n !== '');
                    
                    if (nameList.length === 0) {
                        setIsShuffling(false);
                        return;
                    }

                    const shuffledNames = shuffleArray([...nameList]);
                    const resultGroups = [];
                    for (let i = 0; i < shuffledNames.length; i += size) {
                        resultGroups.push(shuffledNames.slice(i, i + size));
                    }

                    setGroups(resultGroups);
                    setIsShuffling(false);
                }, 800);
            };

            const handleCopy = () => {
                let textResult = `[조 편성 결과]\n\n`;
                groups.forEach((group, idx) => {
                    textResult += `${idx + 1}조: ${group.join(', ')}\n`;
                });
                
                const textArea = document.createElement("textarea");
                textArea.value = textResult;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('Copy failed', err);
                }
                document.body.removeChild(textArea);
            };

            const handleClear = () => {
                if(confirm('모든 내용을 초기화 하시겠습니까?')) {
                    setNames('');
                    setGroups([]);
                }
            };

            // 숫자만 입력받도록 처리하는 함수
            const handleNumberInput = (e) => {
                const value = e.target.value;
                // 숫자이거나 빈 문자열일 때만 상태 업데이트
                if (value === '' || /^[0-9]+$/.test(value)) {
                    setGroupSize(value);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="w-full max-w-5xl flex flex-col lg:flex-row gap-6">
                        
                        <div className="w-full lg:flex-1 bg-indigo-950 bg-opacity-40 backdrop-filter backdrop-blur-xl border border-white border-opacity-20 rounded-3xl p-6 shadow-2xl text-white">
                            <div className="flex items-center gap-3 mb-6">
                                <div className="p-3 bg-white bg-opacity-10 rounded-full">
                                    <UsersIcon />
                                </div>
                                <h1 className="text-2xl font-bold text-white drop-shadow-lg">소리의 랜덤 조 편성기</h1>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2 text-white/90">참여자 이름 입력</label>
                                    <textarea 
                                        className="w-full h-48 bg-black bg-opacity-20 border border-white border-opacity-20 rounded-xl p-4 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50 resize-none transition-all"
                                        placeholder="이름을 입력하세요.&#13;&#10;(줄바꿈이나 쉼표로 구분됩니다)&#13;&#10;예:&#13;&#10;김철수&#13;&#10;이영희&#13;&#10;박지성"
                                        value={names}
                                        onChange={(e) => setNames(e.target.value)}
                                    ></textarea>
                                    <div className="flex justify-between items-center mt-2">
                                        <span className="text-sm text-white/80">
                                            총 {names.split(/[\n,]+/).filter(n => n.trim()).length}명
                                        </span>
                                        <button 
                                            onClick={handleClear}
                                            className="text-sm flex items-center gap-1 text-white/80 hover:text-white transition-colors"
                                        >
                                            <TrashIcon size={14}/> 초기화
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-2 text-white/90">한 조당 인원 수</label>
                                    <div className="relative">
                                        {/* 모바일 이슈 해결의 핵심:
                                            type="text"로 설정하여 브라우저의 자동 숫자 보정(1로 되돌아가는 현상)을 막음.
                                            inputMode="numeric"으로 모바일에서 숫자 키패드가 뜨게 함.
                                        */}
                                        <input 
                                            type="text" 
                                            inputMode="numeric"
                                            pattern="[0-9]*"
                                            className="w-full bg-black bg-opacity-20 border border-white border-opacity-20 rounded-xl p-4 text-white font-bold text-lg focus:outline-none focus:ring-2 focus:ring-white/50"
                                            value={groupSize}
                                            onChange={handleNumberInput}
                                            placeholder="인원 수 입력"
                                        />
                                        <span className="absolute right-4 top-1/2 transform -translate-y-1/2 text-white/80">명씩 묶기</span>
                                    </div>
                                </div>

                                <button 
                                    onClick={handleMakeGroups}
                                    disabled={isShuffling}
                                    className="w-full bg-indigo-600 bg-opacity-60 hover:bg-opacity-80 text-white font-bold py-4 rounded-xl shadow-lg border border-white border-opacity-30 transition-all transform hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2 mt-4"
                                >
                                    {isShuffling ? (
                                        <>
                                            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                                            섞는 중...
                                        </>
                                    ) : (
                                        <>
                                            <RefreshIcon />
                                            조 편성 실행
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>

                        <div className={`w-full lg:flex-1 flex flex-col transition-all duration-500 
                            ${groups.length > 0 
                                ? 'opacity-100 translate-y-0' 
                                : 'opacity-50 translate-y-4 lg:translate-y-0 lg:opacity-100'
                            }`}>
                            
                            <div className="bg-indigo-950 bg-opacity-40 backdrop-filter backdrop-blur-xl border border-white border-opacity-20 rounded-3xl p-6 shadow-2xl h-full overflow-hidden flex flex-col">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold text-white flex items-center gap-2 drop-shadow-md">
                                        <span className="bg-white/10 p-2 rounded-lg">결과</span>
                                        {groups.length > 0 && <span className="text-sm font-normal opacity-90">총 {groups.length}개 조</span>}
                                    </h2>
                                    {groups.length > 0 && (
                                        <button 
                                            onClick={handleCopy}
                                            className="bg-white bg-opacity-10 hover:bg-opacity-20 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 border border-white/10"
                                        >
                                            {copied ? <CheckIcon size={16} /> : <CopyIcon size={16} />}
                                            {copied ? '복사됨' : '결과 복사'}
                                        </button>
                                    )}
                                </div>

                                <div className="flex-1 overflow-y-auto pr-2 custom-scrollbar">
                                    {groups.length === 0 ? (
                                        <div className="h-full flex flex-col items-center justify-center text-white/60 border-2 border-dashed border-white/10 rounded-2xl p-8 min-h-[200px]">
                                            <UsersIcon size={48} className="mb-4 opacity-70" />
                                            <p className="text-center font-medium">왼쪽에서 인원을 입력하고<br/>조 편성 버튼을 눌러주세요</p>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {groups.map((group, idx) => (
                                                <div 
                                                    key={idx} 
                                                    className="bg-black bg-opacity-20 rounded-xl p-4 border border-white border-opacity-10 hover:bg-opacity-30 transition-all animation-fade-in"
                                                    style={{animationDelay: `${idx * 0.1}s`}}
                                                >
                                                    <div className="flex justify-between items-center mb-3 pb-2 border-b border-white/10">
                                                        <span className="font-bold text-white text-lg drop-shadow-sm">{idx + 1}조</span>
                                                        <span className="text-xs bg-white/10 px-2 py-1 rounded-full text-white/90">{group.length}명</span>
                                                    </div>
                                                    <div className="flex flex-wrap gap-2">
                                                        {group.map((member, mIdx) => (
                                                            <span key={mIdx} className="bg-white bg-opacity-10 border border-white/20 text-white px-3 py-1 rounded-lg text-sm font-medium">
                                                                {member}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                    </div>
                    
                    <style>{`
                        @keyframes fadeIn {
                            from { opacity: 0; transform: translateY(10px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                        .animation-fade-in {
                            animation: fadeIn 0.5s ease-out forwards;
                            opacity: 0;
                        }
                    `}</style>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
